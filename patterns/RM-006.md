# RM-006: Function resource contracts

**When to check**: mandatory for all function calls with arguments

**Pattern-specific TodoWrite fields**:
**Risk**: memory leaks, abandoned resources


- Resources accepted: [list with types]
- Return paths traced: [return at line] - original resource [freed/returned/modified/ABANDONED]
- Resource switching: Returns different resource? [YES/NO] - Original handling [describe]
- Resource state per return: Lock state, reference counts, ownership
- Abandonment patterns: "original = new" patterns [YES/NO - locations]

**Mandatory resource contract validation:**
- read full function definition
- track every resource in the TodoWrite
  - track every resource related to modified functions, even if the resource didn't change
- trace EVERY return path - what happens to the original resource?
  - track every return path in modified functions, even if it didn't change
- if function returns different resource, prove original is properly handled
- check lock state, reference counts, and ownership of original resource
- look for assignment patterns like "original = new" that may abandon original

**Mandatory Self-verification gate:**

**Pattern-specific questions**:
  1. Have you traced EVERY return path for EVERY function? [yes/no]
  2. How many functions abandon the original resource? [number]
  3. How many functions return different resources with improper handling? [number]

If you cannot answer ALL questions with evidence, RESTART RM-006 from the beginning.

**Note**: For caller expectation verification, see CS-002
