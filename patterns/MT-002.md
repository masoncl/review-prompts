# MT-002: Size Conversion Patterns

**Risk**: Data loss

**When to check:** Mandatory when bytes converted to pages (round down) `size >> PAGE_SHIFT` (only when truncation intended)

**Pattern-specific TodoWrite fields**:
- Conversion type: [bytes->pages / other]
- Size variable: [name] - [type]
- Size value alignment: [aligned to what boundary]
- Data represented alignment: [aligned to what boundary]
- Memory allocation alignment: [aligned to what boundary]
- Size field alignment: [aligned to what boundary]
- Truncation intended: [YES/NO]
- Data lost: [YES/NO - if YES, impact]
- Alignment validation present: [YES/NO - for data or size]

**Mandatory size conversion validation:**
- read entire function
- track every size conversion in modified functions in TodoWrite, even if they didn't change
- determine the alignment of sizes sent through rounding functions, make sure nothing is lost
- check for alignment validation of the data represented, not just size validation
- track the alignment not just to the memory allocated, but also of the size field itself. Ensure data is not lost due to size truncation.

**Mandatory Self-verification gate:**

**Pattern-specific questions** (in addition to core questions):
  1. How many size conversions did you find? [number]
  2. How many conversions have data loss due to truncation? [number]
  3. Have you checked alignment of BOTH data AND size field for EVERY conversion? [yes/no]
  4. Have you verified alignment validation is present where needed? [yes/no]

If you cannot answer ALL questions with evidence, RESTART MT-002 from the beginning.
