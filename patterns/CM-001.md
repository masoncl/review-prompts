# CM-001: Code movement validation

**Risk**: Stale values/missing state

**When to check:** Mandatory for all non-trivial changes

**Pattern-specific TodoWrite fields**:
- Movement: [from file:line] -> [to file:line]
- Code moved: [exact snippet]
- Variables in scope: [name] - [type] - [modified between locations? YES/NO]
- Loop bounds (if applicable): Original iteration [trace], New iteration [trace], Boundary handling [elements processed/skipped]
- Context dependencies: Locks required [list - available? YES/NO], State required [list - available? YES/NO]
- Conditionals inverted: [YES/NO] If YES [logic correct?]

**Mandatory code movement validation:**
- read full function definition of code src and destination
- track all code movement in modified functions in the TodoWrite, even if they didn't change
- step 1: verify variable scope valid at new location (variables may be modified between old/new location)
- step 2: check loop bounds still valid: trace 3+ iterations with concrete element names
  - for comparison changes: trace old and new iteration side-by-side
  - for(init; condition; advance) checks condition before executing body
  - document which elements are included/excluded from processing
  - verify boundary element handling: is it processed or skipped?
- step 3: verify context dependencies preserved (functions may need locks/state from original location)
- step 4: check for inverted conditionals

**Mandatory Self-verification gate:**

**Pattern-specific questions** (in addition to core questions):
  1. How many code movements did you find? [number]
  2. How many movements have variables modified between old/new location? [number]
  3. Have you traced 3+ iterations for EVERY loop bound change? [yes/no]
  4. Have you verified context dependencies (locks/state) for EVERY movement? [yes/no]

If you cannot answer ALL questions with evidence, RESTART CM-001 from the beginning.
