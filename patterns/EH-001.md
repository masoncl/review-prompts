# EH-001: NULL safety verification

**Risk**: NULL deref

**When to check:** Mandatory when pointers are dereferenced

**Note:**

- ERR_PTR() holds an error cast to a pointer, but they are not valid pointers
  - foo = ERR_PTR(-ENOMEM) ; if (foo) -> TRUE, but *foo will CRASH

**Pattern-specific TodoWrite fields**:
- Pointer: [name] - [type]
- Dereference type: [direct/in BUG_ON/in WARN_ON/other]
- NULL check present: [YES/NO - where]
- NULL check confused with IS_ERR/PTR_ERR: [YES/NO - where]
- Pointer trace: [where from - can be NULL? YES/NO]
- Similar code comparison: [if unsure - snippet and context]
- Registration/export context: [conditions that make code unreachable]

**Mandatory NULL safety validation:**
- read entire function and track every pointer access in modified functions in the TodoWrite, even if they didn't change
- never dereference potentially NULL pointers (including in BUG_ON/WARN_ON statements)
- trace pointers to ensure they are checked for NULL properly
- For global/static pointers: search for ALL assignments including NULL assignments
- For API functions: check registration/export to understand when they can be called
- verify ERR_PTR()s are not dereferenced
- if unsure, check to make sure new code maintains similar checks to old code
 - Add similar checks in old code into the TodoWrite
 - Validate the similar checks are being called in exactly the same context
   - BPF context, interrupt, softirq, any locks held, irqs disabled, preemption/migration disabled, etc
   - disregard any similar checks if their contexts are different

**Mandatory Self-verification gate:**

**Pattern-specific questions**:
  1. How many pointer dereferences did you find? [number]
  2. How many pointers are dereferenced without NULL checks? [number]

If you cannot answer ALL questions with evidence, RESTART EH-001 from the beginning.

**Note**: For tracing NULL passing from callers, see CS-001
