# CL-012: New concurrent access to shared resources

**Risk**: Race condition

**When to check**: Mandatory with any writes to shared resources

**Pattern-specific TodoWrite fields**:
- Resource: [name] - [type]
- New write location: [file:line]
- All write sites found: [file:line] - context [Process/Workqueue/Softirq/Hardirq]
- Race analysis: New write context [context], Can race with Site N [YES/NO - why]
- Synchronization: Type [lock/atomic/barrier/NONE], Details [mechanism], Sufficient [YES/NO]

**Mandatory concurrent access validation:**
- step 1: read entire function
- step 2: identify all shared resources being written (state vars, timers, flags, etc.)
- step 3: use grep/semcode to find ALL other write sites for same resources
- step 4: document execution context for each write site:
  - Process context
  - Workqueue context
  - Softirq context
  - Hardirq context
- step 5: check if new writes can race with existing writes:
  - Softirq can interrupt: process, workqueue
  - Hardirq can interrupt: everything
  - Workqueues can run concurrent with process context
- step 6: check for synchronization (locks, atomic ops, memory barriers)
- track analysis in TodoWrite with resource name, contexts, and values

**Mandatory Self-verification gate:**

**Pattern-specific questions** (in addition to core questions):
  1. How many shared resources with new writes did you find? [number]
  2. Have you found ALL other write sites for EVERY resource? [yes/no]
  3. How many new writes can race with existing writes? [number]
  4. How many racing writes lack proper synchronization? [number]

If you cannot answer ALL questions with evidence, RESTART CL-012 from the beginning.
