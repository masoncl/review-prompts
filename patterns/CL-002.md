# CL-002: Lock handoff and balance

**Risk**: Missing synchronization

**When to check:** Mandatory when locked objects are returned or passed between functions

**Pattern-specific TodoWrite fields**:
- Lock handoff: Original lock [name], Lock at return [same/different], Locked object returned [name/type]
- Lock switching: Original state [acquired/released/held], New state [acquired/released/held], Caller knows which [YES/NO]
- Lock balance per object: [name] - acquired at [line] - released at [line/CALLER]
- Lock drop/reacquire: Dropped/reacquired [YES/NO - list], Objects revalidated [YES/NO - which]

**Mandatory lock handoff validation:**
- read entire function definition
- track lock handoff when returning locked objects in TodoWrite
- when function returns with different lock than originally held:
  - verify original locked object's lock state properly handled
  - check if caller knows which lock to release
  - trace lock acquisition/release balance for ALL objects involved in TodoWrite
- when locks dropped/reacquired, verify protected objects not stale
- load definitions of locking functions to understand them correctly

**Mandatory Self-verification gate:**

**Pattern-specific questions**:
  1. How many lock handoffs did you find? [number]
  2. How many functions return with different locks than originally held? [number]
  3. Have you traced lock balance for ALL objects? [yes/no]
  4. How many lock drop/reacquire patterns have stale object access? [number]

If you cannot answer ALL questions with evidence, RESTART CL-002 from the beginning.

**Note**: For lock requirements in callees, see CS-001
