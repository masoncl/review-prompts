# SM-001: State machine completeness

**Risk**: Invalid state/infinite loop

**When to check**: Mandatory when state or flag variables are modified

**Pattern-specific TodoWrite fields**:
- State/flag variable: [name] - [type]
- Old value/state: [describe]
- New value/state: [describe]
- Modified function: [name at file:line]
- Functions that check flag: [name at line] - [checks new flag? YES/NO]
- Paths that handle state: [description] - [handles new state? YES/NO]
- Stop flags in loops: [list loops - new flag checked? YES/NO]

**Mandatory state machine validation:**
- read entire function
- track all state/flag changes in modified functions in TodoWrite, even if they didn't change
- verify ALL relevant functions check new flags
- ensure all paths handle new states/flags
  - read full function definition of all paths
- check new stop flags in existing loops

**Mandatory Self-verification gate:**

**Pattern-specific questions** (in addition to core questions):
  1. How many state/flag changes did you find? [number]
  2. How many relevant functions do NOT check the new flags? [number]
  3. Have you read the full definition of ALL paths that should handle new states? [yes/no]
  4. Have you checked ALL existing loops for new stop flags? [yes/no]

If you cannot answer ALL questions with evidence, RESTART SM-001 from the beginning.
