# CL-004: Race window analysis

**Risk**: Data corruption

**When to check**: Mandatory when concurrent access to shared datastructures is possible

Place each step defined below into TodoWrite.

**Mandatory race window validation:**
- step 1: read entire functions when concurrent access to shared datastructures is possible
  - Add each function to TodoWrite
  - Output: function name, and a random line from anywhere in each definition
    - you must prove you read the function
- step 2: check all concurrent access in modified functions, even if they didn't change
  - Add every potential concurrent access into TodoWrite
  - Output: quote the actual code and its location
- step 3: verify proper exclusion exists (rcu, locking etc)
  - Output: exclusion method found
- step 4: race windows need hard proof showing that both sides of the race can occur in practice
  - do not worry about theoretical races, only proven races

**Mandatory race window testing:**
- step 5: trace normal execution without interruption
  - Output: execution sequence (e.g., "A→B→C completes normally")
- step 6: trace potential races assuming interruptions or concurrency at every point in critical sections
  - Output: list interruption points checked
- step 7: think about changes introduced by the patch to potential interruptions or concurrency
  - Output: new race windows introduced or "none"
- step 8: think about parallel execution at every step of unlocked access
  - Output: parallel execution scenarios checked
- step 9: think about compiler reordering of assignments (may need barriers)
  - fooA = fooB; fooC = fooD; might be reordered without barriers in place
  - Output: reordering risks found or "none"

**After analysis:** Issues found: [none OR list]
